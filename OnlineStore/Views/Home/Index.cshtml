@using OnlineStore.DBServices
@using OnlineStore.Data
@using Resources = OnlineStore.Common.Properties
@using OnlineStore.Common;

@{
    ProductDBService productService = new ProductDBService();
    IList<Product> products = productService.GetProductCollection().ToList();
    ViewBag.Title = Resources.Labels.AppName;
}

@section scripts
{
    @Scripts.Render("~/Scripts/jquery-1.10.2.js")
}

<div class="jumbotron" style="background-color: #95a5a6; padding: 0; height: 90%;">
    <img style="border: 1px solid; border-radius: 10px; width: 100%; height: 480px" src="~/Images/drone_wallpaper.jpg" @*src='@Url.Content("~/Images/" + randomProduct.Name + ".png")'*@ />
</div>

<div class="row">

    @{
        for (int i = 0; i < 4; i++)
        {
            <div class="col-md-3" style="overflow:auto">

                <div style="display: flex; flex-direction:row; flex-wrap: wrap; margin-left:1px; margin-right:1px; background-color: #ecf0f1; box-sizing:border-box; border-radius: 5px;">
                    <h3 style="padding:5px;">@products[i].Name</h3>
                    <fieldset style="margin:auto; text-align:center">
                        <img src='@Url.Content("~/Images/" + products[i].Name + ".png")' width="200" height="150" />
                    </fieldset>
                    <a style="margin-left: 25px; text-align: center" id="@products[i].Name" class="button btn btn-default">Dodaj do koszyka &raquo;</a>
                    <input type="number" style="width: 50px" class="@products[i].Name" />

                    <div style="display: flex; flex-direction: row; justify-content: center; padding-left: 10%; font-family: 'Courier New'; font-weight: bold;">
                        <div style="padding:3px;" id="price">@products[i].Price zł </div>
                        <div style="padding:3px;" id="inStock">@products.Where(x => x.Name == products[i].Name).FirstOrDefault().QuantityString()</div>
                    </div>
                    
                </div>
            </div>
        }
    }

</div>

<script src="~/Scripts/jquery-1.10.2.js"></script>

<script type="text/javascript">

    $(".button").click(function () {

        let productName = this.id;

        let element = document.getElementsByClassName(productName);
        let amount = element[0].valueAsNumber;

        let url = '@Url.Action("AddProduct", "Cart", new { name = "_name_", amount = "_count_" }, null)';
        url = url.replace("_name_", productName);
        url = url.replace("_count_", amount);
        url = url.replace(";", "");
        url = url.replace("amp", "");

        console.log(url);
        window.location.href = url;
    })

</script>